---
title: "Programming for Data Science"
author: "Mathews Abraham"
date: "2024-05-28"
output: word_document
---

**Question 1.Write the code to analyse the distribution of COVID patients (confirmed or suspected) across countries. Write the code to investigate the distribution of the patients across age groups (e.g., 0-18, 19-35,36-50, 51+). Visualise both the findings using the histogram. Explain your findings.**

```{r}
library(ggplot2)
library(tidyverse)
library(dplyr)

patients1 = read.csv("patientsPG1.csv")
patients2 = read.csv("patientsPG2.csv")
patients = rbind(patients1,patients2)
```
```{r}
conditions1 = read.csv("ConditionsPG1.csv")
conditions2 = read.csv("ConditionsPG2.csv")
condition = rbind(conditions1,conditions2)
conditions = subset(condition, DESCRIPTION %in% c("Suspected COVID-19","COVID-19"), drop = TRUE)
```

Here we have four datasets, two of the contain patient demographic data and others contain information about patient conditions. First, we read all the data using the 'read.csv' function in R, we used this function because the data is in a csv format. Then the datasets having the same variable names were combined into a single dataset, these datasets were named as patients and conditions. 

Here we are analyzing the distribution of covid patients across the counties, the patients data has information about the counties and the conditions have the description of the diagnosis. Since there were other information under the 'DESCRIPTION' variable but we are only interseted if the patients have suspected covid or not, we filtered the dataset with the description of diagnosis either covid-19 or not.

```{r}
county = subset(patients, select = c("Id","COUNTY","BIRTHDATE"))
description = subset(conditions, select = c("PATIENT","DESCRIPTION"))
merged = merge(county,description, by.x = "Id",by.y = "PATIENT", all = FALSE)
head(merged,5)
```

Further, more filteration was carried out to make the dataset more specific, the varibales which are relevant in both the datasets were filtered and merged in a manner with the same ids. The Ids which were present in both the dataset was selected with their respective county names and had covid-19 or just suspection. 

```{r}
covid = subset(merged, DESCRIPTION == "COVID-19", drop = TRUE)
s_covid = unique(merged$Id[!(merged$Id %in% covid$Id)])
sus_covid = merged[!(merged$Id %in% covid$Id),]
final = rbind(covid,sus_covid)
Q1 = subset(final,select = c("COUNTY","DESCRIPTION","BIRTHDATE"))
head(Q1,5)
```


```{r}
Q1_table = table(Q1$COUNTY,Q1$DESCRIPTION)
Q1_table

county_sum= rowSums(Q1_table)

barplot(county_sum,col = 1:5)

```

```{r}

```

Now we have to find the distribution of covid patients across different age group, for this we have to categorise the ages into four different groups 0-18, 19-35, 36-50 and 51 +. Since we do not have the direct ages of patients, instead we calculated it from their date of birth using a function.

```{r}
age = subset(Q1, select = c("BIRTHDATE","DESCRIPTION"))
```

```{r}
age_calculator = function(dob) {
  today = Sys.Date()
  birth.date = as.Date(dob)
  
  birth.year = as.numeric(format(birth.date, "%Y"))
  current_year = as.numeric(format(today, "%Y"))
  
  age = current_year - birth.year
  
  bday = format(today, "%m-%d") < format(birth.date, "%m-%d")
  age[bday] = age[bday] - 1
  
  return(age)
}
```

```{r}

age$AGE = age_calculator(age$BIRTHDATE)
age = age %>%
  mutate(Age.group = case_when(
    AGE>=0 & AGE<=18 ~ "0-18",
    AGE>=19& AGE<=35 ~ "19-35",
    AGE>=36& AGE<=50 ~ "36-50",
    AGE>=51 ~ "51+"
  ))

```


```{r}
#age = subset(age,select = c("Age.group"))

table(age$Age.group)
y= table(age$Age.group)
```
```{r}
barplot(y,col = 4:8)
```
```{r}
Q2 = subset(condition,select = c("PATIENT","DESCRIPTION"))
final  

Q2= Q2%>%
  filter(PATIENT %in% final$Id)


```

```{r}
symptom.count= Q2 %>%
  count(DESCRIPTION)

top.12 = symptom.count %>%
  top_n(12)

top.12 = top.12%>%
  arrange(desc(n))

top.12
top.10 = top.12%>%
  slice(-1,-2)
top.10
```
 

```{r}
Q2.1 = patients%>%
  filter(Id %in% Q2$PATIENT)

```

```{r}
gender = subset(Q2.1,select = c("Id","GENDER"))

gender.des = merge(gender,Q2, by.x = "Id",by.y = "PATIENT", all = FALSE)
```


```{r}
symptom.gender = gender.des %>%
  count(DESCRIPTION,GENDER)

symptom.gender

top.in.gender = symptom.gender%>%
  group_by(GENDER)%>%
  slice_max(order_by = n, n =12, with_ties = TRUE)
  
top.in.gender

reshaped = spread(top.in.gender,GENDER,n)

reshaped = reshaped%>%
  arrange(desc(c(reshaped$F)))

top.10.g = reshaped%>%
  slice(-1,-2)



```

```{r}

encounters1 = read.csv("encountersPG1.csv")
encounters2 = read.csv("encountersPG2.csv")

```

```{r}
#DATA_1

Q3 = encounters1%>%
  filter(PATIENT %in% Q4$PATIENT)
Q3 = subset(Q3, select = c("PATIENT","ENCOUNTERCLASS"))
Q3 = Q3[Q3$ENCOUNTERCLASS %in% c("ambulatory","emergency","inpatient","urgentcare"),]
table(Q3$ENCOUNTERCLASS)

Q3.1 = subset(patients1, select = c("Id","GENDER","RACE"))

Q3.2 = merge(Q3,Q3.1,by.x = "PATIENT", by.y = "Id",all = FALSE)

gender.encounter = table(Q3.2$ENCOUNTERCLASS,Q3.2$GENDER)
gender.encounter

ggplot(Q3.2, aes(x = ENCOUNTERCLASS, fill = GENDER)) +
  geom_bar(position = position_dodge(width = 0.9), color = "black") +
  labs(title = "ENCOUNTERCLASS BETWEEN GENDERS") + 
  theme_bw()+ scale_fill_manual(values = c("lightpink","skyblue"))


prop.gender.1 = prop.table(gender.encounter,margin = 1)*100
prop.gender.1

race.encounter = table(Q3.2$ENCOUNTERCLASS,Q3.2$RACE)
race.encounter

ggplot(Q3.2, aes(x = ENCOUNTERCLASS, fill = RACE)) +
  geom_bar(position = position_dodge(width = 0.9), color = "black") +
  labs(title = "ENCOUNTERCLASS BETWEEN RACE") + 
  theme_bw()


prop.race.1 = prop.table(race.encounter,margin = 1)*100
prop.race.1

```
```{r}
#DATA 2
Qn3 = encounters2%>%
  filter(PATIENT %in% Qn4$PATIENT)
Qn3 = subset(Qn3, select = c("PATIENT","ENCOUNTERCLASS"))
Qn3 = Qn3[Qn3$ENCOUNTERCLASS %in% c("ambulatory","emergency","inpatient","urgentcare"),]
table(Qn3$ENCOUNTERCLASS)

Qn3.1 = subset(patients2, select = c("Id","GENDER","RACE"))

Qn3.2 = merge(Qn3,Qn3.1,by.x = "PATIENT", by.y = "Id",all = FALSE)

gender.encounter2 = table(Qn3.2$ENCOUNTERCLASS,Qn3.2$GENDER)
gender.encounter2

ggplot(Qn3.2, aes(x = ENCOUNTERCLASS, fill = GENDER)) +
  geom_bar(position = position_dodge(width = 0.9), color = "black") +
  labs(title = "ENCOUNTERCLASS BETWEEN GENDERS") + 
  theme_bw()+ scale_fill_manual(values = c("lightpink","skyblue"))

prop.gedner.2 = prop.table(gender.encounter2,margin = 1)*100
prop.gedner.2

race.encounter2 = table(Qn3.2$ENCOUNTERCLASS,Qn3.2$RACE)
race.encounter2
ggplot(Qn3.2, aes(x = ENCOUNTERCLASS, fill = RACE)) +
  geom_bar(position = position_dodge(width = 0.9), color = "black") +
  labs(title = "ENCOUNTERCLASS BETWEEN GENDERS") + 
  theme_bw()

prop.race.2 = prop.table(race.encounter2,margin = 1)*100
prop.race.2



```

**Question.4**


```{r}
#DATA 1
covid.in.1 = subset(conditions1, DESCRIPTION == "COVID-19", drop = TRUE)
suspected.in.1 = subset(conditions1,DESCRIPTION == "Suspected COVID-19"&
                          !PATIENT %in% covid.in.1$PATIENT)
Q4 = rbind(covid.in.1,suspected.in.1)

```

```{r}
Q4$RECOVERY.STAT = ifelse(is.na(Q4$STOP)|Q4$STOP=="", "Not_recovered", "Recovered")
Q4$RECOVERY.TIME = as.Date(Q4$STOP)- as.Date(Q4$START)

Q4.table = table(Q4$DESCRIPTION,Q4$RECOVERY.STAT)
Q4.table

barplot(Q4.table,beside = TRUE,col = c("skyblue","lightpink"))

```
```{r}
patients1$AGE = age_calculator(patients1$BIRTHDATE)
patients1 = patients1 %>%
  mutate(AGE.GROUP = case_when(
    AGE>=0 & AGE<=18 ~ "0-18",
    AGE>=19& AGE<=35 ~ "19-35",
    AGE>=36& AGE<=50 ~ "36-50",
    AGE>=51 ~ "51+"
  ))

Q4.1 = subset(patients1,select = c("Id","AGE","AGE.GROUP","GENDER","ZIP"))

Q4.2 = Q4.1%>%
  filter(Id %in% Q4$PATIENT)

Q4.3 = merge(Q4,Q4.2,by.x = "PATIENT",by.y = "Id",all = FALSE)

Q4.final = subset(Q4.3,select = c("PATIENT","GENDER","AGE","AGE.GROUP",
                              "DESCRIPTION","ZIP","RECOVERY.STAT","RECOVERY.TIME"))
```


```{r}
m =lm(AGE~RECOVERY.TIME,data = Q4.final)
m
summary(m)

```

```{r}
#DATA 2

covid.in.2 = subset(conditions2, DESCRIPTION == "COVID-19", drop = TRUE)
suspected.in.2 = subset(conditions2,DESCRIPTION == "Suspected COVID-19"&
                          !PATIENT %in% covid.in.2$PATIENT)
Qn4 = rbind(covid.in.2,suspected.in.2)

```

```{r}
Qn4$RECOVERY.STAT = ifelse(is.na(Qn4$STOP)|Qn4$STOP=="", "Not_recovered", "Recovered")
Qn4$RECOVERY.TIME = as.Date(Qn4$STOP)- as.Date(Qn4$START)

Qn4.table = table(Qn4$DESCRIPTION,Qn4$RECOVERY.STAT)
Qn4.table
```
```{r}
patients2$AGE = age_calculator(patients2$BIRTHDATE)
patients2 = patients2 %>%
  mutate(AGE.GROUP = case_when(
    AGE>=0 & AGE<=18 ~ "0-18",
    AGE>=19& AGE<=35 ~ "19-35",
    AGE>=36& AGE<=50 ~ "36-50",
    AGE>=51 ~ "51+"
  ))

Qn4.1 = subset(patients2,select = c("Id","AGE","AGE.GROUP","GENDER","ZIP"))

Qn4.2 = Qn4.1%>%
  filter(Id %in% Qn4$PATIENT)

Qn4.3 = merge(Qn4,Qn4.2,by.x = "PATIENT",by.y = "Id",all = FALSE)

Qn4.final = subset(Qn4.3,select = c("PATIENT","GENDER","AGE","AGE.GROUP",
                              "DESCRIPTION","ZIP","RECOVERY.STAT","RECOVERY.TIME"))
```

```{r}
table(Qn4.final$DESCRIPTION,Qn4.final$RECOVERY.STAT)
```

